<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Venta Masiva</title>
    <style>
        :root {
            --azul: #0d1c84;
            --gris: #f4f6fb;
            --sombra: 0 2px 8px rgba(0, 0, 0, 0.1);
            --radio: 8px;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            background: var(--gris);
        }

        header {
            background-color: var(--azul);
            color: white;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        header img {
            height: 30px;
        }

        .contenido {
            padding: 20px;
        }

        .formulario,
        #catalogoProductos,
        #resumenPedido {
            background: white;
            padding: 20px;
            border-radius: var(--radio);
            box-shadow: var(--sombra);
            margin-bottom: 20px;
        }

        h2 {
            margin-top: 0;
            color: var(--azul);
        }

        h3 {
            color: #333;
            margin-bottom: 10px;
        }

        label {
            display: block;
            margin: 8px 0 4px;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 12px;
            border-radius: var(--radio);
            border: 1px solid #ccc;
        }

        .grupoEmpleado.oculto {
            display: none;
        }

        .producto {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: var(--radio);
            padding: 15px;
        }

        .producto img {
            max-width: 200px;
            /* Aumentado de 120px a 200px */
            border-radius: var(--radio);
        }

        .producto-info {
            flex: 1;
        }

        .precio {
            font-weight: bold;
            color: var(--azul);
            margin: 8px 0;
        }

        .radios label {
            margin-right: 10px;
        }

        #btnEnviar {
            padding: 10px 20px;
            background: var(--azul);
            color: white;
            border: none;
            border-radius: var(--radio);
            cursor: pointer;
            font-size: 16px;
        }

        footer.pie {
            background-color: var(--azul);
            color: white;
            padding: 15px;
            text-align: center;
        }

        footer a {
            color: white;
            text-decoration: underline;
        }

        .error {
            border: 2px solid red !important;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: var(--radio);
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-content h3 {
            margin-top: 0;
        }

        .modal-content button {
            margin: 10px 5px 0 0;
            padding: 8px 16px;
            border-radius: var(--radio);
            border: none;
            cursor: pointer;
        }

        .cancelar {
            background: gray;
            color: white;
        }

        .confirmar {
            background: green;
            color: white;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 20px;
            cursor: pointer;
        }

        @media (max-width: 600px) {
            .producto {
                flex-direction: column;
                align-items: center;
            }

            .producto img {
                max-width: 100%;
                /* Ajuste responsivo para pantallas pequeñas */
            }
        }
    </style>
</head>

<body>

    <header>
        <img src="img/logoBeiersdorf.png" alt="Beiersdorf" />
        <h1>Venta Masiva Agosto 2025</h1>
    </header>

    <main class="contenido">
        <section class="formulario">
            <h2>Tipo de Empleado</h2>
            <label><input type="radio" name="tipoEmpleado" value="Interno"> Empleado Interno</label>
            <label><input type="radio" name="tipoEmpleado" value="Externo"> Empleado Externo</label>

            <div id="datosInterno" class="grupoEmpleado oculto">
                <h3>Información de Empleado Interno</h3>
                <input type="text" placeholder="Número de Nómina *" id="nomina" />
                <input type="text" placeholder="Nombre Completo *" id="nombreInterno" />
                <input type="tel" placeholder="Número Celular *" id="celularInterno" maxlength="10" />
                <input type="email" placeholder="Correo Electrónico *" id="correoInterno" />
            </div>

            <div id="datosExterno" class="grupoEmpleado oculto">
                <h3>Información de Empleado Externo</h3>
                <input type="text" placeholder="Nombre Completo *" id="nombreExterno" />
                <input type="tel" placeholder="Número Celular *" id="celularExterno" maxlength="10" />
                <input type="email" placeholder="Correo Electrónico *" id="correoExterno" />
            </div>
        </section>

        <section id="catalogoProductos">
            <h2>Catálogo de Productos</h2>

            <!-- Producto 1 -->
            <div class="producto" data-nombre="Labello Labial" data-precio="1056">
                <img src="img/labello_1.jpg" alt="Labial" />
                <div class="producto-info">
                    <strong>LABELLO Bálsamo labial con color Fresa (4.8g)</strong><br>
                    <span>CAJA CON 32 PIEZAS</span>
                    <p class="precio">$1,056 MXN</p>
                    <div class="radios">
                        <label><input type="radio" name="producto1" value="0" checked /> 0 cajas</label>
                        <label><input type="radio" name="producto1" value="1" /> 1 caja</label>
                        <label><input type="radio" name="producto1" value="2" /> 2 cajas</label>
                        <label><input type="radio" name="producto1" value="3" /> 3 cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 2 -->
            <div class="producto" data-nombre="NIVEA Crema Corporal" data-precio="660">
                <img src="img/crema_corporal_1.jpg" alt="Crema Corporal" />
                <div class="producto-info">
                    <strong>NIVEA Crema Corporal Humectante Regeneración Intensiva (400 ml)</strong><br>
                    <span>CAJA CON 12 PIEZAS</span>
                    <p class="precio">$660 MXN</p>
                    <div class="radios">
                        <label><input type="radio" name="producto2" value="0" checked /> 0 cajas</label>
                        <label><input type="radio" name="producto2" value="1" /> 1 caja</label>
                        <label><input type="radio" name="producto2" value="2" /> 2 cajas</label>
                        <label><input type="radio" name="producto2" value="3" /> 3 cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 3 -->
            <div class="producto" data-nombre="NIVEA Crema Facial" data-precio="4500">
                <img src="img/crema_facial_1.jpg" alt="Crema Facial" />
                <div class="producto-info">
                    <strong>NIVEA Gel Facial Refrescante Cuidado Facial (200 ml)</strong><br>
                    <span>CAJA CON 12 PIEZAS</span>
                    <p class="precio">$4,500 MXN</p>
                    <div class="radios">
                        <label><input type="radio" name="producto3" value="0" checked /> 0 cajas</label>
                        <label><input type="radio" name="producto3" value="1" /> 1 caja</label>
                        <label><input type="radio" name="producto3" value="2" /> 2 cajas</label>
                        <label><input type="radio" name="producto3" value="3" /> 3 cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 4 -->
            <div class="producto" data-nombre="NIVEA MEN Desodorante" data-precio="1500">
                <img src="img/nivea_men_desodorante_1.jpg" alt="MEN Desodorante" />
                <div class="producto-info">
                    <strong>NIVEA MEN Desodorante Antimanchas, Black & White Invisible Power (50 ml)</strong><br>
                    <span>CAJA CON 12 PIEZAS</span>
                    <p class="precio">$1,500 MXN</p>
                    <div class="radios">
                        <label><input type="radio" name="producto4" value="0" checked /> 0 cajas</label>
                        <label><input type="radio" name="producto4" value="1" /> 1 caja</label>
                        <label><input type="radio" name="producto4" value="2" /> 2 cajas</label>
                        <label><input type="radio" name="producto4" value="3" /> 3 cajas</label>
                    </div>
                </div>
            </div>

            <!-- Producto 5 -->
            <div class="producto" data-nombre="NIVEA Crema Tarro" data-precio="250">
                <img src="img/crema_tarro_1.jpg" alt="NIVEA Crema Tarro" />
                <div class="producto-info">
                    <strong>NIVEA Creme Tarro (500ml)</strong><br>
                    <span>CAJA CON 12 PIEZAS</span>
                    <p class="precio">$250 MXN</p>
                    <div class="radios">
                        <label><input type="radio" name="producto5" value="0" checked /> 0 cajas</label>
                        <label><input type="radio" name="producto5" value="1" /> 1 caja</label>
                        <label><input type="radio" name="producto5" value="2" /> 2 cajas</label>
                        <label><input type="radio" name="producto5" value="3" /> 3 cajas</label>
                    </div>
                </div>
            </div>
        </section>

        <section id="resumenPedido">
            <h2>Resumen del Pedido</h2>
            <div id="listaResumen">No hay productos seleccionados</div>
            <p><strong>Total:</strong> <span id="totalResumen">$0.00</span></p>
            <button id="btnEnviar">Enviar Pedido</button>
        </section>
    </main>

    <footer class="pie">
        © 2025 Tiendita BMM – Venta Masiva | <a href="javascript:void(0)" onclick="mostrarAviso()">Aviso de
            Privacidad</a>
    </footer>

    <!-- MODAL AVISO EXTERNO -->
    <div class="modal" id="modalAviso">
        <div class="modal-content">
            <button class="close-modal" onclick="document.getElementById('modalAviso').style.display='none'">✖</button>
            <h3>Aviso de Privacidad</h3>
            <pre id="contenidoAviso" style="white-space: pre-line; font-family: inherit;"></pre>
        </div>
    </div>

    <!-- MODAL CONFIRMACIÓN -->
    <div class="modal" id="modalConfirmacion">
        <div class="modal-content">
            <h3>Confirmar Pedido</h3>
            <div id="detallePedido"></div>
            <button class="cancelar"
                onclick="document.getElementById('modalConfirmacion').style.display='none'">Cancelar</button>
            <button class="confirmar" onclick="confirmarEnvio()">Confirmar Pedido</button>
        </div>
    </div>

    <script>
        const tipoRadios = document.querySelectorAll('input[name="tipoEmpleado"]');
        const interno = document.getElementById('datosInterno');
        const externo = document.getElementById('datosExterno');
        const productos = document.querySelectorAll('.producto');
        const listaResumen = document.getElementById('listaResumen');
        const totalResumen = document.getElementById('totalResumen');
        const celularInterno = document.getElementById('celularInterno');
        const celularExterno = document.getElementById('celularExterno');

        // Restringir entrada a solo números en campos de celular
        [celularInterno, celularExterno].forEach(campo => {
            campo.addEventListener('input', function (e) {
                this.value = this.value.replace(/[^0-9]/g, ''); // Elimina cualquier carácter no numérico
                if (this.value.length > 10) {
                    this.value = this.value.slice(0, 10); // Limita a 10 caracteres
                }
            });
        });

        // Ocultar formularios y radios al cargar
        window.addEventListener('DOMContentLoaded', () => {
            tipoRadios.forEach(r => r.checked = false);
            interno.classList.add("oculto");
            externo.classList.add("oculto");
            actualizarResumen();
        });

        tipoRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                const tipo = document.querySelector('input[name="tipoEmpleado"]:checked')?.value;
                interno.classList.toggle("oculto", tipo !== "Interno");
                externo.classList.toggle("oculto", tipo !== "Externo");
            });
        });

        // Escuchar cambios en los radios de productos
        productos.forEach(producto => {
            const radios = producto.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                radio.addEventListener('change', actualizarResumen);
            });
        });

        function actualizarResumen() {
            let total = 0;
            let resumen = '<h4>Productos Seleccionados:</h4>';
            let tieneProductos = false;

            productos.forEach(p => {
                const nombre = p.dataset.nombre;
                const precio = parseInt(p.dataset.precio);
                const radios = p.querySelectorAll('input[type="radio"]');
                const cantidad = parseInt([...radios].find(r => r.checked)?.value || 0);
                if (cantidad > 0) {
                    const subtotal = precio * cantidad;
                    resumen += `<p>${nombre} x ${cantidad} = $${subtotal.toLocaleString()} MXN</p>`;
                    total += subtotal;
                    tieneProductos = true;
                }
            });

            if (!tieneProductos) {
                resumen = 'No hay productos seleccionados';
            }

            listaResumen.innerHTML = resumen;
            totalResumen.textContent = `$${total.toLocaleString()} MXN`;
        }

        document.getElementById("btnEnviar").addEventListener("click", () => {
            const tipoChecked = document.querySelector('input[name="tipoEmpleado"]:checked');
            if (!tipoChecked) {
                alert("Por favor selecciona si eres Empleado Interno o Externo.");
                return;
            }

            const tipo = tipoChecked.value;
            let valid = true;
            let errores = [];

            const campos = tipo === "Interno" ?
                ["nomina", "nombreInterno", "celularInterno", "correoInterno"] :
                ["nombreExterno", "celularExterno", "correoExterno"];

            campos.forEach(id => {
                const campo = document.getElementById(id);
                campo.classList.remove("error");

                if (!campo.value.trim()) {
                    campo.classList.add("error");
                    valid = false;
                    errores.push(`El campo ${id.replace(/([A-Z])/g, ' $1').toLowerCase()} es obligatorio.`);
                }

                if (id.includes("celular") && !/^\d{10}$/.test(campo.value)) {
                    campo.classList.add("error");
                    valid = false;
                    errores.push("El número de celular debe tener exactamente 10 dígitos numéricos.");
                }

                if (id.includes("correo") && !/^[^@\s]+@[^@\s]+\.com$/.test(campo.value)) {
                    campo.classList.add("error");
                    valid = false;
                    errores.push("El correo debe tener un formato válido (ejemplo: usuario@dominio.com).");
                }
            });

            // Verificar si se seleccionó al menos un producto
            let tieneProductos = false;
            productos.forEach(p => {
                const radios = p.querySelectorAll('input[type="radio"]');
                const cantidad = parseInt([...radios].find(r => r.checked)?.value || 0);
                if (cantidad > 0) {
                    tieneProductos = true;
                }
            });

            if (!tieneProductos) {
                valid = false;
                errores.push("Debes seleccionar al menos un producto (mínimo 1 caja).");
            }

            if (!valid) {
                alert("Por favor corrige los campos resaltados.\n" + errores.join("\n"));
                console.log("Valores de campos:", campos.reduce((obj, id) => ({ ...obj, [id]: document.getElementById(id).value }), {}));
                return;
            }

            // Armar texto del resumen para el modal
            let info = `<p><strong>Tipo:</strong> ${tipo}</p>`;
            if (tipo === "Interno") {
                info += `<p><strong>Nombre:</strong> ${document.getElementById("nombreInterno").value}</p>`;
                info += `<p><strong>Celular:</strong> ${document.getElementById("celularInterno").value}</p>`;
                info += `<p><strong>Correo:</strong> ${document.getElementById("correoInterno").value}</p>`;
            } else {
                info += `<p><strong>Nombre:</strong> ${document.getElementById("nombreExterno").value}</p>`;
                info += `<p><strong>Celular:</strong> ${document.getElementById("celularExterno").value}</p>`;
                info += `<p><strong>Correo:</strong> ${document.getElementById("correoExterno").value}</p>`;
            }

            info += `<h4>Productos Seleccionados:</h4>`;
            productos.forEach(p => {
                const nombre = p.dataset.nombre;
                const precio = parseInt(p.dataset.precio);
                const radios = p.querySelectorAll('input[type="radio"]');
                const cantidad = parseInt([...radios].find(r => r.checked)?.value || 0);
                if (cantidad > 0) {
                    info += `<p>${nombre} x ${cantidad} = $${(precio * cantidad).toLocaleString()} MXN</p>`;
                }
            });

            document.getElementById("detallePedido").innerHTML = info;
            document.getElementById("modalConfirmacion").style.display = "flex";
        });

        function mostrarAviso() {
            fetch("docs/aviso.txt")
                .then(response => {
                    if (!response.ok) {
                        throw new Error("No se pudo cargar el archivo de aviso.");
                    }
                    return response.text();
                })
                .then(texto => {
                    document.getElementById("contenidoAviso").textContent = texto;
                    document.getElementById("modalAviso").style.display = "flex";
                })
                .catch(error => {
                    console.error("Error al cargar el aviso:", error);
                    document.getElementById("contenidoAviso").textContent = "No se pudo cargar el aviso. Por favor, intenta de nuevo más tarde.";
                    document.getElementById("modalAviso").style.display = "flex";
                });
        }

        function confirmarEnvio() {
            const tipo = document.querySelector('input[name="tipoEmpleado"]:checked').value;
            const productosSeleccionados = [];

            productos.forEach(p => {
                const nombre = p.dataset.nombre;
                const precio = parseInt(p.dataset.precio);
                const cantidad = parseInt([...p.querySelectorAll('input[type="radio"]')].find(r => r.checked)?.value || 0);
                if (cantidad > 0) {
                    productosSeleccionados.push({
                        nombre: `${nombre} x ${cantidad}`,
                        total: precio * cantidad
                    });
                }
            });

            const totalFinal = productosSeleccionados.reduce((sum, p) => sum + p.total, 0);

            const data = {
                tipo,
                nomina: tipo === "Interno" ? document.getElementById("nomina").value : '',
                nombre: tipo === "Interno" ? document.getElementById("nombreInterno").value : document.getElementById("nombreExterno").value,
                correo: tipo === "Interno" ? document.getElementById("correoInterno").value : document.getElementById("correoExterno").value,
                celular: tipo === "Interno" ? document.getElementById("celularInterno").value : document.getElementById("celularExterno").value,
                productos: productosSeleccionados
            };

            fetch("https://script.google.com/macros/s/AKfycbzgMKRaneoWHg4OoBaYIEN04p74LPvNLY0lWfrvRTMvHhRBMnu0_NmckAg10xwEsQ9QIA/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(datos)
  })
    .then(res => res.json())
    .then(response => {
      if (response.status === "ok") {
        alert("✅ Pedido enviado correctamente");
        // Aquí puedes generar PDF o resetear el formulario si gustas
      } else {
        alert("❌ Hubo un error al enviar el pedido. Intenta nuevamente.");
      }
    })
    .catch(err => {
      console.error("Error de red:", err);
      alert("❌ Error de red al enviar el pedido. Verifica tu conexión.");
    });
            document.getElementById("modalConfirmacion").style.display = "none";
        }

    </script>

</body>

</html>
